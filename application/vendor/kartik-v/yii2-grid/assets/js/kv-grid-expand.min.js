/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2015
 * @version   3.0.1
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(t){var a=e.gridId,n=e.hiddenFromExport,o=e.detailUrl,l=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,v=e.collapseTitle,c=e.expandAllTitle,p=e.collapseAllTitle,k=e.enableRowClick,u=e.extraData,f=n?e.rowCssClass+" skip-export":e.rowCssClass,x=e.animationDuration,w=t("#"+a),g=w.find(".kv-expand-header-cell"),h=g.find(".kv-expand-header-icon"),m=void 0===e.collapseAll?!1:e.collapseAll,C=void 0===e.expandAll?!1:e.expandAll,R=w.find("td:visible .kv-expand-row:not(.kv-state-disabled)"),N=R.length,A="kv-expand-detail-loading",b=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},T=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},y=function(e,t){e.removeClass(t).addClass(t)},D=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},E=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},I=function(e){y(e,A)},F=function(e){var t=isNaN(x)?1e3:x+200;setTimeout(function(){e.removeClass(A)},t)};return 0===u.length&&(u={}),0===R.length?void y(g,"kv-state-disabled"):(R.each(function(){var e,a,n=t(this),c=n.find(".kv-expand-icon"),p=n.closest("tr"),R=n.closest(".kv-expand-icon-cell"),y=n.find(".kv-expand-detail"),L=n.find(".kv-expanded-row"),U=L.data("key"),j=L.data("index"),K=p.find("td:visible").length;if(!b(c)&&!T(c))return!0;0===L.length&&(U=p.data("key"),e=p.next('tr.kv-expand-detail-row[data-key="'+U+'"]'),L=e.find(".kv-expanded-row"));var Q=function(e){var a=t.extend({expandRowKey:U,expandRowInd:j},u);return I(R),o.length>0&&0===L.html().length?(w.trigger("kvexprow.beforeLoad",[j,U,u]),void L.load(o,a,function(){F(R),l&&t.isFunction(l)&&l(),e(),w.trigger("kvexprow.loaded",[j,U,u])})):(F(R),void e())},q=function(e){w.find('tr[data-index="'+j+'"]').remove(),L.hide(),p.after(L);var t='<tr class="kv-expand-detail-row '+f+'" data-key="'+U+'" data-index="'+j+'">';L.wrap('<td colspan="'+K+'">').parent().wrap(t),c.html(s),R.attr("title",v),e?L.slideDown(x,function(){E(c)}):(L.show(),E(c)),0===o.length&&F(R)},z=function(){I(R),y.html(""),c.html(i),R.attr("title",r),a=L.closest(".kv-expand-detail-row"),L.slideUp(x,function(){L.unwrap().unwrap(),L.appendTo(y),D(c)}),F(R)},B=function(){return R.hasClass(A)?void 0:T(c)?(Q(function(){q(!0)}),w.trigger("kvexprow.toggle",[j,U,u,!0]),void c.focus()):void(b(c)&&(z(),w.trigger("kvexprow.toggle",[j,U,u,!1]),c.focus()))};return C&&d?(T(c)&&Q(function(){q(!0),kvRowNum++,kvRowNum>=N&&(F(g),h.focus())}),kvRowNum>=N&&(F(g),h.focus()),!0):m&&d?(b(c)&&(z(),kvRowNum++,kvRowNum>=N&&(F(g),h.focus())),kvRowNum>=N&&(F(g),h.focus()),!0):(b(c)&&q(!1),R.off("click").on("click",function(){B(R)}),void p.off("click").on("click",function(){k&&B(R)}))}),void(d&&g.off().on("click",function(){if(!g.hasClass(A)&&0!==R.length){var a=T(h),n=b(h),o=t.extend({},e,{expandAll:n,collapseAll:a});I(g),n?(kvRowNum=R.find(".kv-state-collapsed").length,D(h),h.html(s),g.attr("title",p),w.trigger("kvexprow.toggleAll",[u,!1])):a&&(kvRowNum=R.find(".kv-state-expanded").length,E(h),h.html(i),g.attr("title",c),w.trigger("kvexprow.toggleAll",[u,!0])),kvExpandRow(o)}})))}(window.jQuery)};