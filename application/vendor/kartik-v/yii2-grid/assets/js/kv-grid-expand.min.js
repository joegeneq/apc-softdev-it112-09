/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   3.0.0
 *
 * Client actions for yii2-grid expand row
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2015, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */var kvRowNum=0,kvExpandRow;kvExpandRow=function(e){"use strict";!function(t){var a=e.gridId,n=e.hiddenFromExport,o=e.detailUrl,l=e.onDetailLoaded,d=e.batchToggle,i=e.expandIcon,s=e.collapseIcon,r=e.expandTitle,v=e.collapseTitle,c=e.expandAllTitle,p=e.collapseAllTitle,u=n?e.rowCssClass+" skip-export":e.rowCssClass,k=e.animationDuration,f=t("#"+a),x=f.find(".kv-expand-header-cell"),w=x.find(".kv-expand-header-icon"),g=void 0===e.collapseAll?!1:e.collapseAll,h=void 0===e.expandAll?!1:e.expandAll,m=f.find("td:visible .kv-expand-row:not(.kv-state-disabled)"),C=m.length,R="kv-expand-detail-loading",N=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},A=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},b=function(e,t){e.removeClass(t).addClass(t)},T=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},y=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},E=function(e){b(e,R)},I=function(e){var t=isNaN(k)?1e3:k+200;setTimeout(function(){e.removeClass(R)},t)};return 0===m.length?void b(x,"kv-state-disabled"):(m.each(function(){var e,a,n=t(this),c=n.find(".kv-expand-icon"),p=n.closest("tr"),m=n.closest(".kv-expand-icon-cell"),b=n.find(".kv-expand-detail"),D=n.find(".kv-expanded-row"),F=D.data("key"),L=D.data("index"),U=p.find("td:visible").length;if(!N(c)&&!A(c))return!0;0===D.length&&(F=p.data("key"),e=p.next('tr.kv-expand-detail-row[data-key="'+F+'"]'),D=e.find(".kv-expanded-row"));var j=function(e){return E(m),o.length>0&&0===D.html().length?(f.trigger("kvexprow.beforeLoad",[L,F]),void D.load(o,{expandRowKey:F,expandRowInd:L},function(){I(m),l&&t.isFunction(l)&&l(),e(),f.trigger("kvexprow.loaded",[L,F])})):(I(m),void e())},K=function(e){f.find('tr[data-index="'+L+'"]').remove(),D.hide(),p.after(D);var t='<tr class="kv-expand-detail-row '+u+'" data-key="'+F+'" data-index="'+L+'">';D.wrap('<td colspan="'+U+'">').parent().wrap(t),c.html(s),m.attr("title",v),e?D.slideDown(k,function(){y(c)}):(D.show(),y(c)),0===o.length&&I(m)},Q=function(){E(m),b.html(""),c.html(i),m.attr("title",r),a=D.closest(".kv-expand-detail-row"),D.slideUp(k,function(){D.unwrap().unwrap(),D.appendTo(b),T(c)}),I(m)};return h&&d?(A(c)&&j(function(){K(!0),kvRowNum++,kvRowNum>=C&&(I(x),w.focus())}),kvRowNum>=C&&(I(x),w.focus()),!0):g&&d?(N(c)&&(Q(),kvRowNum++,kvRowNum>=C&&(I(x),w.focus())),kvRowNum>=C&&(I(x),w.focus()),!0):(N(c)&&K(!1),void m.off().on("click",function(){return m.hasClass(R)?void 0:A(c)?(j(function(){K(!0)}),f.trigger("kvexprow.toggle",[L,F,!0]),void c.focus()):void(N(c)&&(Q(),f.trigger("kvexprow.toggle",[L,F,!1]),c.focus()))}))}),void(d&&x.off().on("click",function(){if(!x.hasClass(R)&&0!==m.length){var a=A(w),n=N(w),o=t.extend({},e,{expandAll:n,collapseAll:a});E(x),n?(kvRowNum=m.find(".kv-state-collapsed").length,T(w),w.html(s),x.attr("title",p),f.trigger("kvexprow.toggleAll",[!1])):a&&(kvRowNum=m.find(".kv-state-expanded").length,y(w),w.html(i),x.attr("title",c),f.trigger("kvexprow.toggleAll",[!0])),kvExpandRow(o)}})))}(window.jQuery)};